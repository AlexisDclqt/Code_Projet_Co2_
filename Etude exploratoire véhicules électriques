# Etude des véhicules électriques
# Création d'un dataframe pour les véhicules électriques

df_ev = df[df['Type_Carburant'] == 'Electric']
df_ev = df_ev.drop(columns=['Co2_Emission(WLTP)', 'Fuel consumption'])
df_ev.head()

# Retrait des valeurs 'Electric range' à 0

df_ev = df_ev[df_ev['Electric range (km)'] != 0].reset_index(drop=True)

# Descrition rapide de la distribution du panel de véhicules thermiques

variables_etudiees = ['WLTP_poids', 'Electric range (km)', 'Puissance_KW', 'Conso_Wh/km']
df_ev[variables_etudiees].describe()

# Identification et nettoyage des outliers avec des boites à moustaches pour les véhicules électriques

colonnes = ['WLTP_poids', 'Electric range (km)', 'Puissance_KW', 'Conso_Wh/km']
titres = [
    'Distribution des véhicules électriques par poids (kg)',
    'Distribution des véhicules électriques par autonomie (km)',
    'Distribution des véhicules électriques par puissance (kW)',
    'Distribution des véhicules électriques par consommation (Wh/km)'
]

fig, axes = plt.subplots(2, 2, figsize=(12, 8))
axes = axes.flatten()

for i, col in enumerate(colonnes):
    sns.boxenplot(x=col, data=df_ev, ax=axes[i])
    axes[i].set_title(titres[i])

plt.tight_layout()
plt.show()

# Nettoyage des outliers identifiés des véhicules électriques

# Retrait des valeurs 'Puissance_KW' inférieures à 30
df_ev = df_ev[df_ev['Puissance_KW'] >= 30].reset_index(drop=True)

# Retrait des valeurs 'Conso_Wh/km' supérieures à 550
df_ev = df_ev[df_ev['Conso_Wh/km'] <= 580].reset_index(drop=True)

# Matrice de corrélation (heatmap) entre les variables numériques des véhicules électriques

numeric_vars = ['Electric range (km)', 'WLTP_poids', 'Puissance_KW', 'Conso_Wh/km']
corr_matrix = df_ev[numeric_vars].corr()

sns.heatmap(corr_matrix, annot=True, cmap='coolwarm')
plt.title('Corrélation entre les variables numériques des véhicules électriques')
plt.show()

# Nuages de points avec droite de régression linéaire pour les véhicules électriques

df_ev_sample = df_ev.sample(100000)

# Création de la figure et de la grille
fig, axes = plt.subplots(2, 2, figsize=(14, 10))

fig.suptitle(
    "Relations entre les caractéristiques des véhicules électriques",
    fontsize=16
)

# Graphique 1 : Poids vs Autonomie
sns.regplot(
    x='WLTP_poids',
    y='Electric range (km)',
    data=df_ev_sample,
    scatter_kws={'alpha':0.3, 's':20, 'color':'steelblue'},
    line_kws={'color':'red', 'linewidth':2},
    ax=axes[0, 0]
)
axes[0, 0].set_title('Graph. 1 : Poids vs Autonomie')
axes[0, 0].set_xlabel('Poids (kg)')
axes[0, 0].set_ylabel('Autonomie (km)')

# Graphique 2 : Poids vs Consommation
sns.regplot(
    x='WLTP_poids',
    y='Conso_Wh/km',
    data=df_ev_sample,
    scatter_kws={'alpha':0.3, 's':20, 'color':'steelblue'},
    line_kws={'color':'red', 'linewidth':2},
    ax=axes[0, 1]
)
axes[0, 1].set_title('Graph. 2 : Poids vs Consommation')
axes[0, 1].set_xlabel('Poids (kg)')
axes[0, 1].set_ylabel('Consommation (Wh/km)')

# Graphique 3 : Poids vs Puissance
sns.regplot(
    x='WLTP_poids',
    y='Puissance_KW',
    data=df_ev_sample,
    scatter_kws={'alpha':0.3, 's':20, 'color':'steelblue'},
    line_kws={'color':'red', 'linewidth':2},
    ax=axes[1, 0]
)
axes[1, 0].set_title('Graph. 3 : Poids vs Puissance')
axes[1, 0].set_xlabel('Poids (kg)')
axes[1, 0].set_ylabel('Puissance (kW)')

axes[1, 1].axis("off")
plt.tight_layout(rect=[0, 0, 1, 0.96])
plt.show()
